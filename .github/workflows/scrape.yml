name: Daily mortgage rate scraping

on:
  schedule:
    # Triggas dagligen tidigast kl 09:00 UTC (körs när en runner finns tillgänglig)
    # = 09:00 svensk vintertid / 10:00 svensk sommartid
    - cron: "0 8 * * *"

  # Möjlighet att köra manuellt från GitHub UI
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21

      - name: Build backend
        working-directory: backend
        run: mvn -B -DskipTests package

      - name: Run scraper batch
        working-directory: backend
        env:
          SPRING_PROFILES_ACTIVE: prod
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          DATABASE_USERNAME: ${{ secrets.DATABASE_USERNAME }}
          DATABASE_PASSWORD: ${{ secrets.DATABASE_PASSWORD }}
          ADMIN_USERNAME: ${{ secrets.ADMIN_USERNAME }}
          ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
        run: |
          java -jar target/backend-0.0.1-SNAPSHOT.jar --mode=scrape
